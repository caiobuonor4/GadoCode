{% extends 'bovinos/base.html' %}
{% load static %}

{% block content %}
<script src="https://www.paypal.com/sdk/js?client-id=test&currency=BRL"></script>

<div class="p-6 max-w-md mx-auto min-h-screen flex flex-col bg-[#f8f8f8] relative">
    
    <div id="pix-modal" class="fixed inset-0 bg-black bg-opacity-90 z-[9999] hidden flex-col items-center justify-center p-4">
        <div class="bg-white p-6 rounded-3xl w-full max-w-sm text-center shadow-2xl">
            <h3 class="text-xl font-black text-brand mb-1">Pagamento via PIX</h3>
            <p class="text-sm text-gray-500 mb-6">Plano Nelore - R$ 497,00 / ano</p>
            
            <div class="bg-gray-50 p-6 rounded-2xl mb-6 flex flex-col items-center border-2 border-dashed border-gray-200">
                <p class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4">Escaneie o código abaixo</p>
                <img src="{% static 'img/qrcode_pix.png' %}" alt="QR Code PIX GadoCode" class="w-48 h-48 object-contain mix-blend-multiply">
                <p class="text-[10px] text-gray-400 mt-4"><i class="fa-solid fa-lock text-green-500"></i> Pagamento 100% Seguro</p>
            </div>

            <ul class="text-left text-sm text-gray-600 mb-6 space-y-2">
                <li><i class="fa-solid fa-1 text-green-500 mr-2"></i> Abra o app do seu banco.</li>
                <li><i class="fa-solid fa-2 text-green-500 mr-2"></i> Escolha "PIX QR Code".</li>
                <li><i class="fa-solid fa-3 text-green-500 mr-2"></i> Envie o comprovante no WhatsApp.</li>
            </ul>
            
            <a href="https://wa.me/55SEU_NUMERO_AQUI?text=Ol%C3%A1!%20Acabei%20de%20fazer%20o%20PIX%20para%20o%20Plano%20Nelore.%20Meu%20usu%C3%A1rio%20%C3%A9%20{{ user.username }}" target="_blank" class="w-full bg-[#25D366] text-white font-bold py-4 rounded-xl shadow-lg flex justify-center items-center gap-2 hover:bg-[#1ebe5d] transition mb-3">
                <i class="fa-brands fa-whatsapp text-xl"></i> Enviar Comprovante
            </a>

            <button onclick="fecharPix()" class="w-full text-gray-400 font-bold py-3 hover:text-brand transition">
                Cancelar
            </button>
        </div>
    </div>

    <div class="flex justify-between items-center mb-8">
        <a href="{% url 'dashboard' %}" class="text-gray-400 hover:text-brand transition p-2 -ml-2"><i class="fa-solid fa-arrow-left text-2xl"></i></a>
        <h1 class="font-bold text-xl text-brand">Planos GadoCode</h1>
        <div class="w-6"></div>
    </div>

    <div class="text-center mb-8">
        <h2 class="text-2xl font-black text-brand mb-2">Evolua seu rebanho.</h2>
        <p class="text-sm text-gray-500">Escolha o plano ideal para a sua fazenda.</p>
    </div>

    <div class="space-y-6 pb-10">
        <div class="bg-brand border-2 border-brand p-6 rounded-3xl shadow-2xl relative overflow-hidden group">
            <div class="absolute -top-10 -right-10 w-32 h-32 bg-white opacity-10 rounded-full blur-2xl"></div>
            <div class="absolute top-0 right-0 bg-green-500 text-white text-[10px] font-black px-3 py-1 rounded-bl-xl rounded-tr-2xl uppercase tracking-wider shadow-md">Recomendado</div>
            
            <h3 class="text-xl font-bold text-white mb-1 relative z-10">Plano Nelore</h3>
            <div class="flex items-end gap-1 mb-4 relative z-10">
                <div class="text-4xl font-black text-white">R$ 497</div>
                <div class="text-sm text-gray-300 font-medium mb-1">/ano</div>
            </div>
            
            <ul class="text-sm space-y-3 mb-6 text-gray-300 font-medium relative z-10">
                <li class="flex items-center gap-2 text-white"><i class="fa-solid fa-infinity text-green-400"></i> Animais Ilimitados</li>
                <li class="flex items-center gap-2"><i class="fa-solid fa-chart-line text-green-400"></i> Relatórios de Peso</li>
                <li class="flex items-center gap-2"><i class="fa-solid fa-syringe text-green-400"></i> Calendário de Vacinas</li>
            </ul>
            
            <button onclick="abrirPix()" class="relative z-10 w-full bg-[#32BCAD] text-white font-bold py-3 rounded-xl shadow-lg flex justify-center items-center gap-2 hover:bg-[#2aa395] transition mb-3">
                <i class="fa-brands fa-pix"></i> Pagar com PIX
            </button>
            
            <div class="relative z-10 flex items-center gap-3 my-3">
                <div class="flex-1 h-[1px] bg-gray-600"></div>
                <div class="text-gray-400 text-xs font-bold uppercase">ou cartão</div>
                <div class="flex-1 h-[1px] bg-gray-600"></div>
            </div>

            <div id="paypal-button-container" class="relative z-10"></div>
        </div>
    </div>
</div>

<script>
    function abrirPix() {
        document.getElementById('pix-modal').classList.remove('hidden');
        document.getElementById('pix-modal').classList.add('flex');
    }
    function fecharPix() {
        document.getElementById('pix-modal').classList.add('hidden');
        document.getElementById('pix-modal').classList.remove('flex');
    }
    paypal.Buttons({
        style: { shape: 'rect', color: 'white', layout: 'vertical', label: 'subscribe' },
        createOrder: function(data, actions) {
            return actions.order.create({
                purchase_units: [{ description: "GadoCode - Plano Nelore", amount: { currency_code: "BRL", value: '497.00' } }]
            });
        },
        onApprove: function(data, actions) {
            return actions.order.capture().then(function(orderData) {
                alert('Pagamento aprovado. Seu GadoCode agora é PRO!');
                window.location.href = "{% url 'dashboard' %}";
            });
        }
    }).render('#paypal-button-container');
</script>
{% endblock %}